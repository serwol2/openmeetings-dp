name: 'plan feature-push'
on:
  #pull_request:
   push:
    branches:
     - feature
    # path:
    #   - terraform/**
# env:
#   AWS_ACCESS_KEY: ${{secrets.AWS_ACCESS_KEY_ID}}
#   AWS_SECRET_KEY: ${{secrets.AWS_SECRET_KEY_ID}}
  #GITHUB_TOKEN: ${{secrets.GITH_TOKEN}}
  #REGISTRY: ghcr.io
jobs:
  docker-build-and-push:
    name: build-docker-image
    runs-on: ubuntu-latest  
    steps:      
    - name: Login to GitHub Container Registry
      uses: docker/login-action@v1
      with:
        registry: ghcr.io
        username: serwol2 #${{ github.actor }}
        password: ${{ secrets.MY_GITHUB_TOKEN1 }}
    
    # - name: Build and push docker image
    #   uses: docker/build-push-action@v2
    #   with:
    #     # context: .
    #     push: true
    #     tags: ghcr.io/serwol2/app:latest
 
 
 
  # send-email:
  #   runs-on: ubuntu-latest
  #   name: send-email
  #   needs: 
  #     - make_stru_test
  #     - python-lint
  #   steps:
  
  #   - name: Send mail
  #     run: echo "send mail OK :)"
    #   uses: dawidd6/action-send-mail@v3
    #   with:
    #     server_address: smtp.mail.yahoo.com
    #     server_port: 465
    #     username: ${{secrets.MAIL_USERNAME}}
    #     password: ${{secrets.MAIL_PASSWORD}}
    #     subject: Github Actions job result
    #     to: adamal_serg@tut.by
    #     from: ${{secrets.MAIL_USERNAME}} # <user@example.com>
    #     # Optional whether this connection use TLS (default is true if server_port is 465)
    #     secure: false
    #     # Optional plain body:
    #     body: Build job of ${{github.repository}} completed successfully!
    #     # Optional unsigned/invalid certificates allowance:
    #     ignore_cert: false
    #     # Optional converting Markdown to HTML (set content_type to text/html too):
    #     convert_markdown: true
    #     # Optional priority: 'high', 'normal' (default) or 'low'
    #     #priority: low

  # create-pull-request:
  #   runs-on: ubuntu-latest
  #   name: create-pull-request
  #   needs: 
  #     - make_stru_test
  #     - python-lint
  #     - send-email

  #   steps:
  #     - name: Check out repository code
  #       uses: actions/checkout@v2
  #       # with:
  #       #   fetch-depth: 0
  #       #   ref: feature








      # - name: install github cli
      #   run: |
      #     sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-key C99B11DEB97541F0
      #     sudo apt-add-repository https://cli.github.com/packages
      #     sudo apt update
      #     sudo apt install gh

      # - name: auth to github
      #   run: 
      #     gh auth login --with-token ${{ secrets.GITH_TOKEN  }}
    



      # - name: Create Pull Request CLI
      #   run: gh pr create --title "The new feature" --body "test and merge to feature pls" --base dev --head feature
      #   env: 
      #     GITHUB_TOKEN: ${{ secrets.GITH_TOKEN  }}



      # - name: Create Pull Request
      #   uses: peter-evans/create-pull-request@v4
      #   with:
      #     token: ${{ secrets.GITH_TOKEN }}
      #     commit-message: tralala
      #     title: testtest
      #     body: >
      #       This PR is auto-generated by 
      #       [create-pull-request](https://github.com/peter-evans/create-pull-request)
      #     labels: report, automated pr
          # base: feature
          # branch: main
          # draft: true
          
          # reviewers: serwol
          

        # uses: devops-infra/action-pull-request@v0.4.2
        # with:
        #   github_token: ${{ secrets.GITH_TOKEN }}
        #   title: 'Testt'
        #   reviewer: serwol
        #   source_branch: feature 
        #   target_branch: main
        #   draft: true
        #   get_diff: true